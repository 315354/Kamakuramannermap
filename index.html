<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>小町通り 混雑マップ（マナー啓発付き）</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body { margin:0; padding:0; font-family: sans-serif; }
    #map { height: 88vh; }
    #buttons { text-align:center; padding: 10px; background: #f0f0f0; }
    button { margin: 5px; padding: 5px 10px; font-size: 14px; }
    .legend {
      background: white;
      padding: 10px;
      line-height: 1.5;
      box-shadow: 0 0 6px rgba(0,0,0,0.3);
    }
    .legend span {
      display: inline-block;
      width: 12px;
      height: 12px;
      margin-right: 5px;
      vertical-align: middle;
    }
    .marker-label {
      font-weight: bold;
      color: white;
      text-align: center;
      line-height: 24px;
    }
    #tips {
      text-align:center;
      padding: 6px;
      font-size: 14px;
      background: #ffffe0;
      border-top: 1px solid #ccc;
    }
  </style>
</head>
<body>

<div id="buttons">
  <button onclick="showTime('平日昼')">平日昼</button>
  <button onclick="showTime('平日夕方')">平日夕方</button>
  <button onclick="showTime('休日昼')">休日昼</button>
  <button onclick="showTime('休日夕方')">休日夕方</button>
</div>

<div id="map"></div>
<div id="tips">
  ⚠️ 小町通りを歩くときのマナー：歩行中はスマホを見ずに周りに注意しましょう。ゴミは持ち帰り、他の人に迷惑をかけないようにしてください。
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  const map = L.map('map').setView([35.321, 139.552], 17);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // すべてのスポット・店舗情報をまとめる
  const spots = [
    {lat:35.319438, lng:139.551231, name:"スポット1", tips:"歩行中は周りに注意"},
    {lat:35.320434, lng:139.551728, name:"スポット2", tips:"ゴミは必ず持ち帰ろう"},
    {lat:35.322326, lng:139.552648, name:"スポット3", tips:"譲り合いの歩行を心がけよう"},
    {lat:35.324279, lng:139.553704, name:"スポット4", tips:"歩きスマホ禁止"},
    {lat:35.32076265208144, lng:139.55178481003765, name:"ジラッファ 鎌倉小町通り店", tips:"・ゴミは必ず持ち帰りましょう<br>・混雑時は順番を守って並びましょう<br>・大声で話さず、周囲に配慮しましょう<br>・ペットは抱っこまたはリードを使用しましょう"},
    {lat:35.321100, lng:139.552000, name:"カフェ小町", tips:"・席は譲り合って座りましょう<br>・混雑時は順番を守って列に並びましょう"},
    {lat:35.320500, lng:139.552500, name:"和菓子屋小町", tips:"・試食は1口だけにしましょう<br>・ゴミは必ず持ち帰りましょう"},
    {lat:35.32099551453905, lng:139.5521661593194, name:"MAISON CACAO 鎌倉小町店", tips:"・チョコレート購入後はゴミを持ち帰りましょう<br>・混雑時は順番を守り、譲り合いましょう"},
    {lat:35.32287228279184, lng:139.5530859746436, name:"鎌倉茶々本店 Kamakura ChaCha", tips:"・行列に並ぶときは前後の人に注意<br>・ゴミは必ず持ち帰りましょう<br>・ペット同伴は抱っこで"}
  ];

  // 時間帯ごとの混雑レベル（スポット順に対応）
  const congestionLevels = {
    "平日昼": ["やや混雑","やや混雑","空き","空き","やや混雑","やや混雑","混雑","やや混雑","混雑"],
    "平日夕方": ["混雑","混雑","やや混雑","やや混雑","混雑","混雑","混雑","混雑","混雑"],
    "休日昼": ["混雑","混雑","混雑","やや混雑","混雑","やや混雑","混雑","やや混雑","混雑"],
    "休日夕方": ["やや混雑","やや混雑","やや混雑","空き","やや混雑","やや混雑","やや混雑","やや混雑","やや混雑"]
  };

  let currentMarkers = [];

  function getColor(level) {
    if(level === "混雑") return "red";
    if(level === "やや混雑") return "orange";
    return "green";
  }

  function showTime(time) {
    currentMarkers.forEach(m => map.removeLayer(m));
    currentMarkers = [];

    spots.forEach((spot, index) => {
      const level = congestionLevels[time][index];
      const marker = L.circleMarker([spot.lat, spot.lng], {
        radius: 15,
        fillColor: getColor(level),
        color: getColor(level),
        fillOpacity: 0.9
      }).addTo(map);

      marker.bindPopup(`<b>${spot.name}</b><br>${time}<br>混雑度: ${level}<br>マナー:<br>${spot.tips}`);

      // スポットのみラベル
      const label = L.divIcon({
        className: 'marker-label',
        html: spot.name.startsWith("スポット") ? spot.name.replace("スポット","") : "",
        iconSize: [24,24],
        iconAnchor: [12,12]
      });
      const labelMarker = L.marker([spot.lat, spot.lng], {icon: label}).addTo(map);

      currentMarkers.push(marker);
      currentMarkers.push(labelMarker);
    });
  }

  showTime("平日昼");

  // 凡例
  const legend = L.control({position: 'bottomright'});
  legend.onAdd = function() {
    const div = L.DomUtil.create('div', 'legend');
    div.innerHTML = `
      <b>混雑目安</b><br>
      <span style="background:red"></span>混雑<br>
      <span style="background:orange"></span>やや混雑<br>
      <span style="background:green"></span>空き
    `;
    return div;
  };
  legend.addTo(map);
</script>

</body>
</html>
