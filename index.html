<script>
// 既存店舗に追加する新しい店舗
const newStores = [
  {
    lat: 35.3218792159195,
    lng: 139.55255664628976,
    name: "鎌倉着物レンタル和楽",
    tips: {
      ja: "・レンタル時の着物は丁寧に扱いましょう<br>・混雑時は順番を守りましょう",
      en: "- Handle rented kimono carefully<br>- Follow the queue during busy times"
    }
  },
  {
    lat: 35.32243404058744,
    lng: 139.5527143339346,
    name: "鎌倉甘味処くるみ",
    tips: {
      ja: "・甘味を食べたらゴミは持ち帰りましょう<br>・順番を守って並びましょう",
      en: "- Take trash home after eating<br>- Follow the queue"
    }
  }
];

// 既存の stores 配列に追加
stores.push(...newStores);

// 店舗色を自動割り当て
const storeColors = ["blue","purple","skyblue","pink","green","orange"];
stores.forEach((store,i)=>{
  store.color = storeColors[i % storeColors.length];
});

// showTime 関数内の店舗マーカー表示を修正
function showTime(time){
  currentTime = time;
  currentMarkers.forEach(m => map.removeLayer(m));
  currentMarkers = [];

  // スポットマーカー
  spots.forEach((spot,index)=>{
    const level = congestionLevels[time][index];
    const marker = L.circleMarker([spot.lat, spot.lng],{
      radius:15, fillColor:getColor(level), color:getColor(level), fillOpacity:0.9
    }).addTo(map);
    marker.on('click',()=>{
      document.getElementById('tips').innerHTML=`<b>${spot.name}</b><br>混雑度:${level}<br>マナー:<br>${spot.tips[currentLanguage]}`;
    });

    const label = L.divIcon({
      className:'marker-label',
      html:spot.name.replace("スポット",""),
      iconSize:[24,24], iconAnchor:[12,12]
    });
    const labelMarker = L.marker([spot.lat,spot.lng],{icon:label}).addTo(map);

    currentMarkers.push(marker,labelMarker);
  });

  // 店舗マーカー
  stores.forEach(store=>{
    const marker = L.circleMarker([store.lat,store.lng],{
      radius:18, fillColor:store.color, color:store.color, fillOpacity:0.9
    }).addTo(map);
    marker.on('click',()=>{
      document.getElementById('tips').innerHTML=`<b>${store.name}</b><br>マナー:<br>${store.tips[currentLanguage]}`;
    });
    currentMarkers.push(marker);
  });
}

// 初期表示を更新
showTime(currentTime);
</script>
