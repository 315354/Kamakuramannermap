<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>小町通り 混雑マップ（スポット番号付き・時間帯切替）</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body { margin:0; padding:0; font-family: sans-serif; }
    #map { height: 90vh; }
    #buttons { text-align:center; padding: 10px; background: #f0f0f0; }
    button { margin: 5px; padding: 5px 10px; font-size: 14px; }
    .legend {
      background: white;
      padding: 10px;
      line-height: 1.5;
      box-shadow: 0 0 6px rgba(0,0,0,0.3);
    }
    .legend span {
      display: inline-block;
      width: 12px;
      height: 12px;
      margin-right: 5px;
      vertical-align: middle;
    }
    .marker-label {
      font-weight: bold;
      color: white;
      text-align: center;
      line-height: 24px;
    }
  </style>
</head>
<body>

<div id="buttons">
  <button onclick="showTime('平日昼')">平日昼</button>
  <button onclick="showTime('平日夕方')">平日夕方</button>
  <button onclick="showTime('休日昼')">休日昼</button>
  <button onclick="showTime('休日夕方')">休日夕方</button>
</div>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  // マップ作成
  const map = L.map('map').setView([35.321, 139.552], 17);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // 4スポットの時間帯ごとの混雑データ
  const congestionData = {
    "平日昼": [
      {lat:35.31943819283287, lng:139.55123093860553, level:"やや混雑", name:"スポット1"},
      {lat:35.32043390024664, lng:139.55172832211414, level:"やや混雑", name:"スポット2"},
      {lat:35.32232618247578, lng:139.5526479032834, level:"空き", name:"スポット3"},
      {lat:35.324278593700186, lng:139.55370448717107, level:"空き", name:"スポット4"}
    ],
    "平日夕方": [
      {lat:35.31943819283287, lng:139.55123093860553, level:"混雑", name:"スポット1"},
      {lat:35.32043390024664, lng:139.55172832211414, level:"混雑", name:"スポット2"},
      {lat:35.32232618247578, lng:139.5526479032834, level:"やや混雑", name:"スポット3"},
      {lat:35.324278593700186, lng:139.55370448717107, level:"やや混雑", name:"スポット4"}
    ],
    "休日昼": [
      {lat:35.31943819283287, lng:139.55123093860553, level:"混雑", name:"スポット1"},
      {lat:35.32043390024664, lng:139.55172832211414, level:"混雑", name:"スポット2"},
      {lat:35.32232618247578, lng:139.5526479032834, level:"混雑", name:"スポット3"},
      {lat:35.324278593700186, lng:139.55370448717107, level:"やや混雑", name:"スポット4"}
    ],
    "休日夕方": [
      {lat:35.31943819283287, lng:139.55123093860553, level:"やや混雑", name:"スポット1"},
      {lat:35.32043390024664, lng:139.55172832211414, level:"やや混雑", name:"スポット2"},
      {lat:35.32232618247578, lng:139.5526479032834, level:"やや混雑", name:"スポット3"},
      {lat:35.324278593700186, lng:139.55370448717107, level:"空き", name:"スポット4"}
    ]
  };

  // 現在表示中のマーカー
  let currentMarkers = [];

  // 混雑レベルに応じた色
  function getColor(level) {
    if(level === "混雑") return "red";
    if(level === "やや混雑") return "orange";
    return "green";
  }

  // マーカー表示更新
  function showTime(time) {
    // 既存マーカー削除
    currentMarkers.forEach(m => map.removeLayer(m));
    currentMarkers = [];

    // 新規マーカー作成
    congestionData[time].forEach(item => {
      const marker = L.circleMarker([item.lat,item.lng], {
        radius: 15,
        fillColor: getColor(item.level),
        color: getColor(item.level),
        fillOpacity: 0.9
      }).addTo(map);

      marker.bindPopup(`<b>${item.name}</b><br>${time}<br>混雑度: ${item.level}`);

      // マーカーに番号ラベル追加
      const label = L.divIcon({
        className: 'marker-label',
        html: item.name.replace("スポット",""),
        iconSize: [24,24],
        iconAnchor: [12,12]
      });
      const labelMarker = L.marker([item.lat,item.lng], {icon: label}).addTo(map);

      currentMarkers.push(marker);
      currentMarkers.push(labelMarker);
    });
  }

  // 初期表示
  showTime('平日昼');

  // 凡例
  const legend = L.control({position: 'bottomright'});
  legend.onAdd = function() {
    const div = L.DomUtil.create('div', 'legend');
    div.innerHTML = `
      <b>混雑目安</b><br>
      <span style="background:red"></span>混雑<br>
      <span style="background:orange"></span>やや混雑<br>
      <span style="background:green"></span>空き
    `;
    return div;
  };
  legend.addTo(map);

</script>

</body>
</html>

