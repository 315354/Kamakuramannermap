<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Kamakura Map - 店舗投稿版</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
html, body { margin:0; padding:0; height:100%; font-family:sans-serif; }
body { display:flex; }
#map { flex:1; height:100vh; }
#sidebar {
  width:360px;
  max-width:80%;
  background:#f0f0f0;
  overflow-y:auto;
  position:fixed;
  right:0;
  top:0;
  bottom:0;
  padding:15px;
  box-sizing:border-box;
  z-index:1000;
}
h2 { margin-top:0; }
.category { margin-top:20px; }
.category h3 { margin-bottom:10px; border-bottom:1px solid #ccc; padding-bottom:4px; font-size:16px; color:#333; }
.item { margin-bottom: 15px; padding: 10px; border-radius: 5px; cursor: pointer; box-shadow: 0 1px 3px rgba(0,0,0,0.1); background-color:#fff; color:#333; transition: transform 0.2s, box-shadow 0.2s;}
.item:hover { transform: scale(1.02); box-shadow:0 4px 8px rgba(0,0,0,0.2);}
.item.selected { transform: scale(1.05); box-shadow:0 6px 12px rgba(0,0,0,0.3); }
.item img { width:100%; border-radius:4px; margin-bottom:8px; }
.item .title { font-size:16px; font-weight:bold; margin-bottom:4px; display:flex; align-items:center; }
.item p { margin:0; font-size:14px; line-height:1.3; }
#form { margin-top:20px; border-top:1px solid #ccc; padding-top:10px;}
#form input, #form textarea { width:100%; margin-bottom:6px; padding:6px; box-sizing:border-box;}
#form button { padding:6px 12px; background:#3498db; color:#fff; border:none; cursor:pointer; border-radius:3px;}
</style>
</head>
<body>

<div id="map"></div>

<div id="sidebar">
  <h2>マナー啓発 / Manners</h2>
  <div id="list"></div>

  <div id="form">
    <h3>マナーを追加</h3>
    <input id="titleJP" placeholder="タイトル（日本語）">
    <input id="titleEN" placeholder="Title (EN)">
    <input id="lat" placeholder="緯度 (例: 35.320)" type="number" step="0.000001">
    <input id="lng" placeholder="経度 (例: 139.552)" type="number" step="0.000001">
    <input id="img" placeholder="画像URL">
    <textarea id="detailJP" placeholder="説明（日本語）"></textarea>
    <textarea id="detailEN" placeholder="Description (EN)"></textarea>
    <button onclick="addManner()">追加</button>
  </div>
</div>

<script>
// マップ作成
var map = L.map('map').setView([35.3198, 139.5520], 17);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:19 }).addTo(map);

var listDiv = document.getElementById("list");
var points = [];

// カード＆マーカー追加関数
function addPoint(point){
  var marker = L.marker([point.lat, point.lng]).addTo(map)
    .bindPopup(`<b>${point.titleJP}</b><br>${point.detailJP}<hr><b>${point.titleEN}</b><br>${point.detailEN}`);

  var item = document.createElement("div");
  item.className = "item";
  item.innerHTML = `<img src="${point.img}" alt="${point.titleJP}">
  <div class="title">${point.titleJP} / ${point.titleEN}</div>
  <p>${point.detailJP}<br>${point.detailEN}</p>`;

  item.addEventListener("click", function(){
    document.querySelectorAll(".item").forEach(el=>el.classList.remove("selected"));
    this.classList.add("selected");
    map.setView([point.lat, point.lng],18);
    marker.openPopup();
  });

  listDiv.appendChild(item);
  points.push(point);
}

// 初期サンプルポイント
addPoint({lat:35.319376, lng:139.551265, titleJP:"ゴミは持ち帰ろう", titleEN:"Take your trash home", detailJP:"入口付近ではゴミは必ず持ち帰りましょう。", detailEN:"Please take your trash home.", img:"https://cdn.pixabay.com/photo/2017/02/01/22/02/trash-2034250_960_720.jpg"});

// フォームから追加
function addManner(){
  var point = {
    titleJP: document.getElementById("titleJP").value,
    titleEN: document.getElementById("titleEN").value,
    lat: parseFloat(document.getElementById("lat").value),
    lng: parseFloat(document.getElementById("lng").value),
    img: document.getElementById("img").value,
    detailJP: document.getElementById("detailJP").value,
    detailEN: document.getElementById("detailEN").value
  };
  if(!point.titleJP || !point.lat || !point.lng){
    alert("タイトルと座標は必須です！");
    return;
  }
  addPoint(point);

  // フォームをリセット
  document.getElementById("titleJP").value="";
  document.getElementById("titleEN").value="";
  document.getElementById("lat").value="";
  document.getElementById("lng").value="";
  document.getElementById("img").value="";
  document.getElementById("detailJP").value="";
  document.getElementById("detailEN").value="";
}
</script>

</body>
</html>

