<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Kamakura Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
  html, body { margin:0; padding:0; height:100%; font-family:sans-serif; }
  body { display:flex; transition: all 0.3s; }

  #map { flex:1; transition: margin-left 0.3s; height:100vh; }

  #sidebar {
    width:300px;
    max-width:70%;
    background:#f5f5f5;
    overflow-y:auto;
    position:fixed;
    left:-300px;
    top:0;
    bottom:0;
    transition:left 0.3s;
    padding:10px;
    box-sizing:border-box;
    z-index:1000;
  }
  #sidebar.open { left:0; }

  .toggle-btn {
    position:fixed;
    top:10px;
    left:0;
    z-index:1100;
    padding:6px 10px;
    background:#3498db;
    color:#fff;
    border:none;
    cursor:pointer;
    border-radius:3px;
    font-size:14px;
    transition:left 0.3s;
  }
  .toggle-btn.open { left:300px; }

  .item { margin-bottom: 15px; padding: 8px; border-radius: 4px; cursor: pointer; box-shadow: 0 1px 3px rgba(0,0,0,0.1); color:#fff; font-weight: bold; }
  .item:hover { opacity: 0.85; }
  .high { background-color: #e74c3c; }    
  .medium { background-color: #f39c12; }  
  .low { background-color: #27ae60; }     
  .item img { width:100%; border-radius:4px; margin-bottom:5px; }
  .item p { margin:0; font-weight:normal; color:#fff; }

  /* スマホ対応 */
  @media(max-width:768px){
    body { flex-direction: column; }
    #sidebar { width:100%; left:-100%; }
    #sidebar.open { left:0; }
    #map { height:50vh; margin-left:0; }
    .toggle-btn.open { left:0; }
  }
</style>
</head>
<body>

<button id="toggleBtn" class="toggle-btn" onclick="toggleSidebar()">☰</button>
<div id="sidebar">
  <h2>マナー啓発ポイント</h2>
  <div id="list"></div>
</div>
<div id="map"></div>

<script>
  var sidebarOpen = false;
  var sidebar = document.getElementById('sidebar');
  var toggleBtn = document.getElementById('toggleBtn');

  function toggleSidebar() {
    sidebarOpen = !sidebarOpen;
    if(sidebarOpen){
      sidebar.classList.add('open');
      toggleBtn.classList.add('open');
    } else {
      sidebar.classList.remove('open');
      toggleBtn.classList.remove('open');
    }
  }

  // マップ作成
  var map = L.map('map').setView([35.3198, 139.5520], 17);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:19 }).addTo(map);

  var points = [
    {lat:35.319376, lng:139.551265, title:"小町通り 大鳥居", detail:"入口付近ではゴミは必ず持ち帰りましょう。", level:"high", img:"https://cdn.pixabay.com/photo/2017/02/01/22/02/trash-2034250_960_720.jpg"},
    {lat:35.320342, lng:139.551733, title:"小町通り商店街", detail:"歩きながらの飲食は控えましょう。", level:"medium", img:"https://cdn.pixabay.com/photo/2017/08/10/03/25/eating-2611922_960_720.jpg"},
    {lat:35.322364, lng:139.552682, title:"小町通り", detail:"通りではペットはリード必須です。", level:"low", img:"https://cdn.pixabay.com/photo/2016/11/29/10/07/dog-1868085_960_720.jpg"},
    {lat:35.324273, lng:139.553724, title:"小町通り終点", detail:"観光客同士や地元の方に迷惑をかけないように心がけましょう。", level:"medium", img:"https://cdn.pixabay.com/photo/2015/09/05/21/51/tourist-926051_960_720.jpg"}
  ];

  var listDiv = document.getElementById("list");

  function getIcon(level){
    var color = (level==="high")?"red":(level==="medium")?"orange":"green";
    return L.icon({
      iconUrl: "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-" + color + ".png",
      shadowUrl: "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",
      iconSize: [25,41],
      iconAnchor: [12,41],
      popupAnchor: [1,-34],
      shadowSize: [41,41]
    });
  }

  points.forEach(function(point){
    var marker = L.marker([point.lat, point.lng], {icon:getIcon(point.level)}).addTo(map)
      .bindPopup("<b>"+point.title+"</b><br>"+point.detail);

    var item = document.createElement("div");
    item.className = "item " + point.level;
    item.innerHTML = `<img src="${point.img}" alt="${point.title}"><strong>${point.title}</strong><p>${point.detail}</p>`;
    item.onclick = function(){
      map.setView([point.lat, point.lng],18);
      marker.openPopup();
    };
    listDiv.appendChild(item);
  });

  // ルート
  L.polyline([
    [35.319414,139.551258],
    [35.320386,139.551759],
    [35.322326,139.552674],
    [35.324286,139.553731]
  ], { color:'#ff0000', weight:8, opacity:0.5, dashArray:'10,10' }).addTo(map);

  // ズーム固定
  map.scrollWheelZoom.disable();
  map.touchZoom.disable();
  map.doubleClickZoom.disable();
  map.boxZoom.disable();
  map.keyboard.disable();
  map.setMinZoom(17);
  map.setMaxZoom(17);

</script>
</body>
</html>


