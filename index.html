<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Kamakura Map - 混雑デモ</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  html, body { margin:0; padding:0; height:100%; font-family:sans-serif; }
  body { display:flex; }
  #map { flex:1; height:100vh; }
  #sidebar {
    width:360px; max-width:80%; background:#f0f0f0; overflow-y:auto;
    position:fixed; left:-360px; top:0; bottom:0; transition:left 0.3s;
    padding:15px; box-sizing:border-box; z-index:1000;
  }
  #sidebar.open { left:0; }
  #toggleBtn {
    position:fixed; top:10px; left:0; z-index:1100; padding:6px 12px;
    background:#3498db; color:#fff; border:none; cursor:pointer; border-radius:3px;
  }
  .item { margin-bottom: 15px; padding:10px; border-radius:5px; cursor:pointer;
          box-shadow:0 1px 3px rgba(0,0,0,0.1); background:#fff; transition:0.2s; }
  .item:hover { transform:scale(1.02); box-shadow:0 4px 8px rgba(0,0,0,0.2);}
  .item img { width:100%; border-radius:4px; margin-bottom:8px; }
  .title { font-weight:bold; margin-bottom:4px; }
</style>
</head>
<body>

<button id="toggleBtn" onclick="toggleSidebar()">☰ マナー啓発</button>
<div id="sidebar">
  <h2>マナー啓発 / Manners</h2>
  <div id="list"></div>
</div>
<div id="map"></div>

<script>
var sidebarOpen = false;
function toggleSidebar() {
  sidebarOpen = !sidebarOpen;
  document.getElementById('sidebar').classList.toggle('open', sidebarOpen);
}

// マップ作成
var map = L.map('map').setView([35.3198, 139.5520], 17);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:19 }).addTo(map);

// 混雑度と色の対応
var levels = ["low","medium","high"];
var levelColors = {low:"green", medium:"orange", high:"red"};

// デモデータ
var points = [
  {lat:35.319376, lng:139.551265, title:"ゴミは持ち帰ろう", detail:"入口付近ではゴミは必ず持ち帰りましょう。", level:"low"},
  {lat:35.320342, lng:139.551733, title:"飲食は休憩所で", detail:"歩きながらの飲食は控えましょう。", level:"medium"},
  {lat:35.322364, lng:139.552682, title:"ペットはリード必須", detail:"ペットは必ずリードをつけましょう。", level:"high"}
];

// マーカー作成用関数
function getIcon(level){
  return L.icon({
    iconUrl: "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-" + levelColors[level] + ".png",
    shadowUrl: "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",
    iconSize: [25,41],
    iconAnchor: [12,41],
    popupAnchor: [1,-34],
    shadowSize: [41,41]
  });
}

// サイドバーとマーカー
var listDiv = document.getElementById("list");
points.forEach(function(point){
  var marker = L.marker([point.lat, point.lng], {icon:getIcon(point.level)}).addTo(map)
    .bindPopup("<b>"+point.title+"</b><br>"+point.detail+"<br>混雑度: "+point.level);

  var item = document.createElement("div");
  item.className="item";
  item.innerHTML = `<div class="title">${point.title}</div><p>${point.detail}</p><button>混雑度: ${point.level}</button>`;
  
  var btn = item.querySelector("button");
  btn.addEventListener("click", function(){
    // レベル更新
    var idx = levels.indexOf(point.level);
    idx = (idx+1)%levels.length;
    point.level = levels[idx];
    // ボタン表示更新
    btn.textContent = "混雑度: "+point.level;
    // マーカー色更新
    marker.setIcon(getIcon(point.level));
    marker.setPopupContent("<b>"+point.title+"</b><br>"+point.detail+"<br>混雑度: "+point.level);
  });

  item.addEventListener("click", function(){
    map.setView([point.lat, point.lng],18);
    marker.openPopup();
  });

  listDiv.appendChild(item);
});

// ズーム固定
map.scrollWheelZoom.disable();
map.touchZoom.disable();
map.doubleClickZoom.disable();
map.boxZoom.disable();
map.keyboard.disable();
map.setMinZoom(17);
map.setMaxZoom(17);

</script>
</body>
</html>


