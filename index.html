<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>小町通り 混雑マップ（スマホ向け）</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
body { margin:0; font-family:sans-serif; background:#f7f7f7; }
header { background:#ffcc33; padding:15px; text-align:center; font-size:22px; font-weight:bold; color:#333; box-shadow:0 2px 4px rgba(0,0,0,0.2);}
#controls { text-align:center; padding:5px; }
button { margin:3px; padding:6px 12px; font-size:14px; border-radius:5px; border:none; cursor:pointer; background:#4CAF50; color:white; transition:0.2s;}
button:hover { background:#45a049;}
#map { height:90vh; margin:0 auto; max-width:100%; border:2px solid #ccc; border-radius:8px; }
#tips { max-width:100%; margin:5px auto; padding:8px; background:#ffffe0; border:1px solid #ccc; border-radius:5px; font-size:15px; min-height:60px; }
.legend { background:white; padding:8px; line-height:1.5; box-shadow:0 0 6px rgba(0,0,0,0.3); font-size:14px;}
.legend span { display:inline-block; width:12px; height:12px; margin-right:5px; vertical-align:middle; }
.marker-label { font-weight:bold; color:white; text-align:center; line-height:24px; font-size:12px; }

@media (max-width:480px){
  #map { height:95vh; }
  #tips { font-size:16px; min-height:60px; }
  header { font-size:20px; padding:12px; }
}
</style>
</head>
<body>

<header>小町通り 混雑マップ（マナー表示付き）</header>

<div id="controls">
  <div id="language-buttons">
    <button onclick="setLanguage('ja')">日本語</button>
    <button onclick="setLanguage('en')">English</button>
  </div>
  <div id="buttons">
    <button onclick="showTime('平日昼')">平日昼</button>
    <button onclick="showTime('平日夕方')">平日夕方</button>
    <button onclick="showTime('休日昼')">休日昼</button>
    <button onclick="showTime('休日夕方')">休日夕方</button>
  </div>
</div>

<div id="map"></div>
<div id="tips"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const map = L.map('map', {
  center: [35.3219, 139.5525],
  zoom: 17,
  dragging: false,
  scrollWheelZoom: false,
  doubleClickZoom: false,
  boxZoom: false,
  keyboard: false,
  tap: false
});

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
 attribution:'&copy; OpenStreetMap contributors'
}).addTo(map);

const texts = {
  ja: { mapTips:"⚠️ 小町通りを歩くときのマナー：歩行中はスマホを見ずに周りに注意、ゴミは持ち帰りましょう。", congestionLegend:{"混雑":"混雑","やや混雑":"やや混雑","空き":"空き"} },
  en: { mapTips:"⚠️ Manners on Komachi Street: Watch your surroundings, do not look at your smartphone while walking, take your trash home.", congestionLegend:{"混雑":"Crowded","やや混雑":"Somewhat crowded","空き":"Empty"} }
};

const spots = [
  {lat:35.319438,lng:139.551231,name:"スポット1",tips:{ja:"歩行中は周りに注意",en:"Watch your surroundings"}},
  {lat:35.320434,lng:139.551728,name:"スポット2",tips:{ja:"ゴミは必ず持ち帰ろう",en:"Take your trash home"}},
  {lat:35.322326,lng:139.552648,name:"スポット3",tips:{ja:"譲り合いの歩行を心がけよう",en:"Walk considerately"}},
  {lat:35.324279,lng:139.553704,name:"スポット4",tips:{ja:"歩きスマホ禁止",en:"No smartphone while walking"}}
];

const stores = [
  {lat:35.32076265208144,lng:139.55178481003765,name:"ジラッファ 鎌倉小町通り店",tips:{ja:"・ゴミは必ず持ち帰りましょう<br>・混雑時は順番を守って並びましょう<br>・大声で話さず、周囲に配慮しましょう<br>・ペットは抱っこまたはリードを使用しましょう",en:"- Take your trash home<br>- Follow queue<br>- Speak quietly<br>- Hold pets"}},
  {lat:35.32099551453905,lng:139.5521661593194,name:"MAISON CACAO 鎌倉小町店",tips:{ja:"・チョコレート購入後はゴミを持ち帰りましょう<br>・混雑時は順番を守り、譲り合いましょう",en:"- Take trash home after buying chocolate<br>- Follow queue and share space"}},
  {lat:35.32287228279184,lng:139.5530859746436,name:"鎌倉茶々本店 Kamakura ChaCha",tips:{ja:"・行列に並ぶときは前後の人に注意<br>・ゴミは必ず持ち帰りましょう<br>・ペット同伴は抱っこで",en:"- Watch people before/after in line<br>- Take trash home<br>- Hold pets"}},
  {lat:35.3218792159195,lng:139.55255664628976,name:"鎌倉着物レンタル和楽",tips:{ja:"・レンタル時の着物は丁寧に扱いましょう<br>・混雑時は順番を守りましょう",en:"- Handle rented kimono carefully<br>- Follow the queue during busy times"}},
  {lat:35.3197672004631,lng:139.55136766056182,name:"鎌倉茶々 小町通り店",tips:{ja:"・混雑時は譲り合いましょう<br>・ゴミは持ち帰りましょう",en:"- Share space during busy times<br>- Take trash home"}}
];

const congestionLevels = { "平日昼":["やや混雑","やや混雑","空き","空き"], "平日夕方":["混雑","混雑","やや混雑","やや混雑"], "休日昼":["混雑","混雑","混雑","やや混雑"], "休日夕方":["やや混雑","やや混雑","やや混雑","空き"] };

let currentMarkers=[],currentLanguage='ja',currentTime='平日昼';

function getColor(level){ return level==="混雑"?"red":level==="やや混雑"?"orange":"green"; }
function setLanguage(lang){ currentLanguage=lang; document.getElementById('tips').innerHTML=texts[lang].mapTips; showTime(currentTime); }

function showTime(time){
  currentTime=time;
  currentMarkers.forEach(m=>map.removeLayer(m)); currentMarkers=[];
  spots.forEach((spot,index)=>{
    const level=congestionLevels[time][index];
    const marker=L.circleMarker([spot.lat,spot.lng],{radius:15, fillColor:getColor(level), color:getColor(level), fillOpacity:0.9}).addTo(map);
    marker.on('click',()=>{document.getElementById('tips').innerHTML=`<b>${spot.name}</b><br>混雑度:${level}<br>マナー:<br>${spot.tips[currentLanguage]}`;});
    const label=L.divIcon({className:'marker-label',html:spot.name.replace("スポット",""),iconSize:[24,24], iconAnchor:[12,12]});
    const labelMarker=L.marker([spot.lat,spot.lng],{icon:label}).addTo(map);
    currentMarkers.push(marker,labelMarker);
  });
  stores.forEach(store=>{
    const marker=L.circleMarker([store.lat,store.lng],{radius:18, fillColor:"blue", color:"blue", fillOpacity:0.9}).addTo(map);
    marker.on('click',()=>{document.getElementById('tips').innerHTML=`<b>${store.name}</b><br>マナー:<br>${store.tips[currentLanguage]}`;});
    currentMarkers.push(marker);
  });
}

setLanguage('ja');

const legend=L.control({position:'bottomright'});
legend.onAdd=function(){
  const div=L.DomUtil.create('div','legend'); 
  div.innerHTML=`<b>混雑目安</b><br>
  <span style="background:red"></span>${texts[currentLanguage].congestionLegend["混雑"]}<br>
  <span style="background:orange"></span>${texts[currentLanguage].congestionLegend["やや混雑"]}<br>
  <span style="background:green"></span>${texts[currentLanguage].congestionLegend["空き"]}<br>
  <span style="background:blue"></span>店舗`;
  return div;
};
legend.addTo(map);
</script>
</body>
</html>
